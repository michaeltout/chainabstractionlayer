(()=>{"use strict";var t={917:function(t,e,r){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var s=r(522),u=r(882),c=r(831),l=r(521),p=r(960),f=function(t){function e(e){var r=t.call(this)||this;return r._createTransactionInstruction=function(t,e,r,n){var i=new c.PublicKey(r);return new c.TransactionInstruction({keys:[{pubkey:t.publicKey,isSigner:!0,isWritable:!0},{pubkey:e.publicKey,isSigner:!1,isWritable:!0}],programId:i,data:Buffer.from(n)})},r._network=e,r}return i(e,t),e.prototype.getSwapSecret=function(t){return o(this,void 0,void 0,(function(){var e;return a(this,(function(r){switch(r.label){case 0:return[4,this.getMethod("getTransactionByHash")(t)];case 1:if(!(e=r.sent()))throw new p.TxNotFoundError("Transaction with hash: "+t+" was not found");return[2,null==e?void 0:e.secret]}}))}))},e.prototype.initiateSwap=function(t){return o(this,void 0,void 0,(function(){var e,r,n,i,o,s,u,f,h,d,y,w;return a(this,(function(a){switch(a.label){case 0:return l.validateSwapParams(t),[4,this.getMethod("_getSigner")()];case 1:return e=a.sent(),r=this._network.programId,n=t.expiration,i=t.refundAddress,o=t.recipientAddress,s=t.value,u=t.secretHash,f=l.createInitBuffer({buyer:o.toString(),seller:i.toString(),expiration:n,secret_hash:u,value:s.toNumber()}),h=new c.Keypair,[4,this.getMethod("_getMinimumBalanceForRentExemption")(f.length)];case 2:if(d=a.sent(),s.lt(d))throw new p.WalletError("Invalid amount. Cannot be less than "+d+" LAMPORTS");return y=this._createStorageAccountInstruction(e,h,s,f.length,r),w=this._createTransactionInstruction(e,h,r,f),[4,this.getMethod("sendTransaction")({instructions:[y,w],accounts:[h]})];case 3:return[2,a.sent()]}}))}))},e.prototype.claimSwap=function(t,e,r){return o(this,void 0,void 0,(function(){var n,i,o,s,u,p,f,h,d;return a(this,(function(a){switch(a.label){case 0:return l.validateSwapParams(t),[4,Promise.all([this.getMethod("getConnectedNetwork")(),this.getMethod("getTransactionReceipt")([e]),this.verifyInitiateSwapTransaction(t,e)])];case 1:return n=a.sent(),i=n[0].programId,o=n[1][0],s=o._raw,u=s.buyer,p=s.programAccount,[4,this._checkIfProgramAccountExists(p)];case 2:return a.sent(),f=new c.PublicKey(p),h=new c.PublicKey(u),[4,this._collectLamports(f,h,l.createClaimBuffer(r),i)];case 3:return d=a.sent(),[4,this.getMethod("sendTransaction")({instructions:[d]})];case 4:return[2,a.sent()]}}))}))},e.prototype.refundSwap=function(t,e){return o(this,void 0,void 0,(function(){var r,n,i,o,s,u,p,f,h;return a(this,(function(a){switch(a.label){case 0:return l.validateSwapParams(t),[4,Promise.all([this.getMethod("getConnectedNetwork")(),this.getMethod("getTransactionReceipt")([e]),this.verifyInitiateSwapTransaction(t,e)])];case 1:return r=a.sent(),n=r[0].programId,i=r[1][0],o=i._raw,s=o.seller,u=o.programAccount,[4,this._checkIfProgramAccountExists(u)];case 2:return a.sent(),p=new c.PublicKey(u),f=new c.PublicKey(s),[4,this._collectLamports(p,f,l.createRefundBuffer(),n.toString())];case 3:return h=a.sent(),[4,this.getMethod("sendTransaction")({instructions:[h]})];case 4:return[2,a.sent()]}}))}))},e.prototype.fundSwap=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,null]}))}))},e.prototype.verifyInitiateSwapTransaction=function(t,e){return o(this,void 0,void 0,(function(){var r;return a(this,(function(n){switch(n.label){case 0:return[4,this.getMethod("getTransactionByHash")(e)];case 1:if((r=n.sent()).status!==s.TxStatus.Success)throw new p.StandardError("Status for transaction "+e+" is "+r.status);return[2,l.doesTransactionMatchInitiation(t,r._raw)]}}))}))},e.prototype._collectLamports=function(t,e,r,n){return o(this,void 0,void 0,(function(){var i,o;return a(this,(function(a){switch(a.label){case 0:return[4,this.getMethod("_getSigner")()];case 1:return i=a.sent(),o=new c.PublicKey(n),[2,new c.TransactionInstruction({keys:[{pubkey:i.publicKey,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!0}],programId:o,data:Buffer.from(r)})]}}))}))},e.prototype._createStorageAccountInstruction=function(t,e,r,n,i){var o=e.publicKey,a=new c.PublicKey(i);return c.SystemProgram.createAccount({fromPubkey:t.publicKey,newAccountPubkey:o,lamports:r.toNumber(),space:n,programId:a})},e.prototype._checkIfProgramAccountExists=function(t){return o(this,void 0,void 0,(function(){var e;return a(this,(function(r){switch(r.label){case 0:return[4,this.getMethod("_getAccountInfo")(t)];case 1:if(!(e=r.sent()))throw new p.InvalidAddressError("AccountDoesNotExist");return[2,e]}}))}))},e}(u.Provider);e.default=f},175:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.SolanaSwapProvider=void 0;var i=n(r(917));e.SolanaSwapProvider=i.default},960:t=>{t.exports=require("@liquality/errors")},882:t=>{t.exports=require("@liquality/provider")},521:t=>{t.exports=require("@liquality/solana-utils")},522:t=>{t.exports=require("@liquality/types")},831:t=>{t.exports=require("@solana/web3.js")}},e={},r=function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}(175);module.exports=r})();
//# sourceMappingURL=index.js.map