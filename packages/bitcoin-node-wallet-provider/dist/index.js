(()=>{"use strict";var t={210:function(t,e,r){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function u(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}c((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},u=this&&this.__spreadArray||function(t,e){for(var r=0,n=e.length,i=t.length;r<n;r++,i++)t[i]=e[r];return t};Object.defineProperty(e,"__esModule",{value:!0});var c=r(543),a=r(517),d=r(130),h=r(993),p=r(522),l=r(320),f=r(524),v=r(939),y={main:l.BitcoinNetworks.bitcoin,test:l.BitcoinNetworks.bitcoin_testnet,regtest:l.BitcoinNetworks.bitcoin_regtest},b=function(t){function e(e){var r=this,n=e.uri,i=e.username,s=e.password,o=e.network,u=e.addressType,c=void 0===u?p.bitcoin.AddressType.BECH32:u;r=t.call(this,{network:o})||this;var a=Object.values(p.bitcoin.AddressType);if(!a.includes(c))throw new Error("addressType must be one of "+a.join(","));return r._addressType=c,r._network=o,r._rpc=new h.JsonRpcProvider(n,i,s),r._addressInfoCache={},r}return i(e,t),e.prototype.signMessage=function(t,e){return s(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this._rpc.jsonrpc("signmessage",e,t).then((function(t){return Buffer.from(t,"base64").toString("hex")}))]}))}))},e.prototype.withTxFee=function(t,e){return s(this,void 0,void 0,(function(){var r,n,i;return o(this,(function(s){switch(s.label){case 0:return r=new p.BigNumber(e).div(1e8).times(1e3).toNumber(),[4,this._rpc.jsonrpc("getwalletinfo")];case 1:return n=s.sent().paytxfee,[4,this._rpc.jsonrpc("settxfee",r)];case 2:return s.sent(),[4,t()];case 3:return i=s.sent(),[4,this._rpc.jsonrpc("settxfee",n)];case 4:return s.sent(),[2,i]}}))}))},e.prototype._sendTransaction=function(t){return s(this,void 0,void 0,(function(){var e,r,n,i;return o(this,(function(s){switch(s.label){case 0:return e=new p.BigNumber(t.value).dividedBy(1e8).toNumber(),[4,this._rpc.jsonrpc("sendtoaddress",t.to,e,"","",!1,!0)];case 1:return r=s.sent(),[4,this._rpc.jsonrpc("gettransaction",r,!0)];case 2:return n=s.sent(),i=new p.BigNumber(n.fee).abs().times(1e8).toNumber(),[2,f.normalizeTransactionObject(f.decodeRawTransaction(n.hex,this._network),i)]}}))}))},e.prototype.sendTransaction=function(t){return s(this,void 0,void 0,(function(){var e=this;return o(this,(function(r){return[2,t.fee?this.withTxFee((function(){return s(e,void 0,void 0,(function(){return o(this,(function(e){return[2,this._sendTransaction(t)]}))}))}),t.fee):this._sendTransaction(t)]}))}))},e.prototype.updateTransactionFee=function(t,e){return s(this,void 0,void 0,(function(){var r,n=this;return o(this,(function(i){return r=a.isString(t)?t:t.hash,[2,this.withTxFee((function(){return s(n,void 0,void 0,(function(){var t,e,n;return o(this,(function(i){switch(i.label){case 0:return[4,this._rpc.jsonrpc("bumpfee",r)];case 1:return t=i.sent(),[4,this._rpc.jsonrpc("gettransaction",t.txid,!0)];case 2:return e=i.sent(),n=new p.BigNumber(e.fee).abs().times(1e8).toNumber(),[2,f.normalizeTransactionObject(f.decodeRawTransaction(e.hex,this._network),n)]}}))}))}),e)]}))}))},e.prototype.signPSBT=function(t,e){return s(this,void 0,void 0,(function(){var r,n,i,s,u,a;return o(this,(function(d){switch(d.label){case 0:r=c.Psbt.fromBase64(t,{network:this._network}),n=function(t){var e,n,s,u;return o(this,(function(o){switch(o.label){case 0:return[4,i.getUsedAddresses()];case 1:return e=o.sent(),n=e.find((function(e){return e.derivationPath===t.derivationPath})),[4,i.dumpPrivKey(n.address)];case 2:return s=o.sent(),u=c.ECPair.fromWIF(s,i._network),r.signInput(t.index,u),[2]}}))},i=this,s=0,u=e,d.label=1;case 1:return s<u.length?(a=u[s],[5,n(a)]):[3,4];case 2:d.sent(),d.label=3;case 3:return s++,[3,1];case 4:return[2,r.toBase64()]}}))}))},e.prototype.signBatchP2SHTransaction=function(t,e,r,n,i){return void 0===i&&(i=!1),s(this,void 0,void 0,(function(){var n,s,u,a,d,h,p,l,f,v;return o(this,(function(o){switch(o.label){case 0:n=[],s=0,u=e,o.label=1;case 1:return s<u.length?(a=u[s],[4,this.dumpPrivKey(a)]):[3,4];case 2:d=o.sent(),h=c.ECPair.fromWIF(d,this._network),n.push(h),o.label=3;case 3:return s++,[3,1];case 4:for(p=[],l=0;l<t.length;l++)void 0,f=i?r.hashForWitnessV0(t[l].index,t[l].outputScript,t[l].vout.vSat,c.Transaction.SIGHASH_ALL):r.hashForSignature(t[l].index,t[l].outputScript,c.Transaction.SIGHASH_ALL),v=c.script.signature.encode(n[l].sign(f),c.Transaction.SIGHASH_ALL),p.push(v);return[2,p]}}))}))},e.prototype.dumpPrivKey=function(t){return s(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._rpc.jsonrpc("dumpprivkey",t)]}))}))},e.prototype.getNewAddress=function(t,e){return void 0===e&&(e=""),s(this,void 0,void 0,(function(){var r,n,i;return o(this,(function(s){switch(s.label){case 0:return r=t?[e,t]:[e],[4,(i=this._rpc).jsonrpc.apply(i,u(["getnewaddress"],r))];case 1:return(n=s.sent())?[2,this.getAddressInfo(n)]:[2,null]}}))}))},e.prototype.getAddressInfo=function(t){return s(this,void 0,void 0,(function(){var e,r,n,i;return o(this,(function(s){switch(s.label){case 0:return t in this._addressInfoCache?[2,this._addressInfoCache[t]]:[4,this._rpc.jsonrpc("getaddressinfo",t)];case 1:return(e=s.sent()).iswatchonly||(r=e.pubkey,n=e.hdkeypath),i=new p.Address({address:t,publicKey:r,derivationPath:n}),this._addressInfoCache[t]=i,[2,i]}}))}))},e.prototype.getAddresses=function(){return s(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.getUsedAddresses()]}))}))},e.prototype.getUnusedAddress=function(){return s(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.getNewAddress(this._addressType)]}))}))},e.prototype.getUsedAddresses=function(){return s(this,void 0,void 0,(function(){var t,e,r,n=this;return o(this,(function(i){switch(i.label){case 0:return[4,this._rpc.jsonrpc("listaddressgroupings")];case 1:return t=i.sent(),[4,this._rpc.jsonrpc("listreceivedbyaddress",0,!0,!1)];case 2:return e=i.sent(),r=a.uniq(u(u([],a.flatten(t).map((function(t){return t[0]}))),e.map((function(t){return t.address})))),[4,Promise.all(r.map((function(t){return n.getAddressInfo(t)})))];case 3:return[2,i.sent()]}}))}))},e.prototype.getWalletAddress=function(t){return s(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.getAddressInfo(t)]}))}))},e.prototype.isWalletAvailable=function(){return s(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rpc.jsonrpc("getwalletinfo")];case 1:return t.sent(),[2,!0];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.getConnectedNetwork=function(){return s(this,void 0,void 0,(function(){var t,e;return o(this,(function(r){switch(r.label){case 0:return[4,this._rpc.jsonrpc("getblockchaininfo")];case 1:return t=r.sent(),e=t.chain,[2,y[e]]}}))}))},e.prototype.generateSecret=function(t){return s(this,void 0,void 0,(function(){var e,r,n,i;return o(this,(function(s){switch(s.label){case 0:e="secretAddress",s.label=1;case 1:return s.trys.push([1,3,,5]),[4,this._rpc.jsonrpc("getaddressesbylabel",e)];case 2:return n=s.sent(),r=Object.keys(n)[0],[3,5];case 3:return s.sent(),[4,this.getNewAddress(p.bitcoin.AddressType.LEGACY,e)];case 4:return r=s.sent().address,[3,5];case 5:return[4,this.signMessage(t,r)];case 6:return i=s.sent(),[2,v.sha256(i)]}}))}))},e}(d.WalletProvider);e.default=b},175:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.BitcoinNodeWalletProvider=void 0;var i=n(r(210));e.BitcoinNodeWalletProvider=i.default},320:t=>{t.exports=require("@liquality/bitcoin-networks")},524:t=>{t.exports=require("@liquality/bitcoin-utils")},939:t=>{t.exports=require("@liquality/crypto")},993:t=>{t.exports=require("@liquality/jsonrpc-provider")},522:t=>{t.exports=require("@liquality/types")},130:t=>{t.exports=require("@liquality/wallet-provider")},543:t=>{t.exports=require("bitcoinjs-lib")},517:t=>{t.exports=require("lodash")}},e={},r=function r(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,r),s.exports}(175);module.exports=r})();
//# sourceMappingURL=index.js.map